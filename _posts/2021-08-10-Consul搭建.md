## Consul搭建CentOS

```angular2html
sudo yum install -y yum-utils
```
```angular2html
sudo yum-config-manager --add-repo https://rpm.releases.hashicorp.com/RHEL/hashicorp.repo
```
```angular2html
sudo yum -y install consul
```
## 启动
```angular2html
consul agent -server -bootstrap-expect=1 -data-dir=/tmp/consul -node=192.168.1.111 -bind=192.168.1.111 -client=0.0.0.0 -datacenter=qingdao1 -ui
```
- server 以server身份启动。默认是client
- bootstrap-expect：集群要求的最少server数量，当低于这个数量，集群即失效
- data-dir：data存放的目录
- node：节点id，集群中的每个node必须有一个唯一的名称。默认情况下，Consul使用机器的hostname
- bind：监听的ip地址。默认绑定0.0.0.0，可以不指定。表示Consul监听的地址,而且它必须能够被集群中的其他节点访问。Consul默认会监听第一个private IP,但最好还是提供一个。生产设备上的服务器通常有好几个网卡，所以指定一个不会出错
- client: 客户端的ip地址，0.0.0.0是指谁都可以访问（不加这个，下面的ui :8500无法访问）
- ui: 可以访问UI界面
- -config-dir指定配置文件夹，Consul会加载其中的所有文件
- -datacenter 指定数据中心名称，默认是dc1
## 加入集群
```angular2html
consul join 192.168.1.111
```
## 集群状态查看
```angular2html
consul operator raft list-peers
```
## 查看members状态
```angular2html
consul members
```
## 集群参数get/set测试
```angular2html
consul kv put addr nanshan
consul kv get addr
```
## 集群单机故障处理
- 单机consul进程故障发生
- 杀死三台机器中任意一台机器上的consul进程
```angular2html
ps -ef | grep consul
kill -9 24811
```
如Leader发生故障然后丢失，剩下的两台机重新进行leader选举
```angular2html
consul operator raft list-peers
```